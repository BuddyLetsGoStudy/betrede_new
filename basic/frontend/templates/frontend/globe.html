<html>
    <head>
           <meta charset="utf-8">
           <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
       <script type="application/javascript" src="https://logachev.top/static/api.js"></script>
       <link href="/static/frontend/main.css" rel="stylesheet" >

           <!-- <link rel="stylesheet" href="https://logachev.top/static/main.css"> -->
   
       <style>
           html, body{padding: 0; margin: 0;}
           #earth_div{top: 0; right: 0; bottom: 0; left: 0; position: absolute !important;}
       </style>
       <title>Betrede</title>
       

<link rel="apple-touch-icon" sizes="180x180" href="https://betrede.com/static/frontend/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://betrede.com/static/frontend/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://betrede.com/static/frontend/img/favicon-16x16.png">
<link rel="manifest" href="https://betrede.com/static/frontend/img/site.webmanifest">
<link rel="shortcut icon" href="https://betrede.com/static/frontend/img/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="https://betrede.com/static/frontend/img/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


   </head>
   <header>
       <a href="/" class="header-logo"></a>
       <div class="header-globe"></div>
       <div class="header-search"></div>
    </header>
    </body>
   <body onload="initialize()" >
    
   <div id="earth_div" style="z-index: 1;"></div>

   <script>
    if (localStorage.getItem('token')) {
        document.querySelector('header').innerHTML += `         <a href="/myspaces" class="header-text">My spaces</a>
        <a href="/create" class="header-text">Create</a>
        <a href="/logout/" class="header-text">Log out</a>`
    } else {
        document.querySelector('header').innerHTML += `<a class="header-text" href="/register">Sign up</a> <a class="header-text" href="/login/">Log in</a>`
    }
    function initialize() {
        if (location.hash) {
            const geo = location.hash.replace("#", '').replace("%20", '').split(",")
            var sc = [parseFloat(geo[0], 10), parseFloat(geo[1], 10)]
            console.log(sc)
            var bounds = [[sc[0] + 0.006, sc[1] - 0.006], [sc[0] - 0.006, sc[1] + 0.006]];
        } else {
            var bounds = [[55.820119, 37.501564], [55.691915, 37.753624]];
        }
      

        
        var earth = new WE.map('earth_div');
        earth.setView([36.057944835, 112.18688965], 2);
        var osm = WE.tileLayer('https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',{
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(earth);
        fetch(`https://betrede.com/api/spaces/`)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                data.map(space => {
                    console.log(space);
                    if (space.published) {
                        var marker = WE.marker([space.geo.split(',')[0], space.geo.split(',')[1].replace(/\s/g, '')], 'https://old.betrede.com/markers/artist_painter.png', 30, 30).addTo(earth);
                        marker.bindPopup(`<b>${space.name}</b><br><span> ${space.author}</span><br><a  href='https://betrede.com/space/${space.id}/'> Explore</a>`, {maxWidth: 150, closeButton: true});
                    }
                })
            })
            .then(() => {
                const icons = document.getElementsByClassName('we-pm-icon');
                console.log(icons);
                for (let icon of icons) {
                    icon.onclick = () => {
                        console.log('fuck you;');
                        for (let mda of document.getElementsByClassName('we-pp')) {
                            mda.style.visibility = 'hidden';
                            mda.style.opacity = 0;
                        }
                        icon.nextSibling.style.visibility = 'visible';
                        icon.nextSibling.style.opacity = 1;
                        console.log(icon.nextSibling);
                    }
                }
            })

        // var marker = WE.marker([55.740238, 37.634573], 'markers/artist_painter.png', 30, 30).addTo(earth);
        // marker.bindPopup("<b>Rinat Mustaffin</b><br>Artist.<br /><span> Gallery</span><a  href='/Rinat'> Explore</a>", {maxWidth: 150, closeButton: true});

        // var marker = WE.marker([55.732020, 37.607471], 'markers/artist_painter.png', 30, 30).addTo(earth);
        // marker.bindPopup("<b>Artem Syulev</b><br>Artist.<br /><span> Gallery</span><a  href='/Syulev'> Explore</a>", {maxWidth: 150, closeButton: true});

        // var marker2 = WE.marker([55.788817,  37.705988], 'markers/artist_painter.png', 30, 30).addTo(earth);
        // marker2.bindPopup("<b>Vladimir Vikhrov</b><br>Creator<br /><span> Gallery</span><a href='/Vikhrov'> Explore</a> ", {maxWidth: 150, closeButton: true});

        // var marker3 = WE.marker([55.766183, 37.633477],  'markers/artist_painter.png', 30, 30).addTo(earth);
        // marker3.bindPopup("<b>Group Russia</b><br>Group of Artists<br /><span> Gallery</span><a href='/russia'> Explore</a> ", {maxWidth: 150, closeButton: true});

        // var marker4 = WE.marker([55.831403, 37.629064],  'markers/artist_arch.png', 30, 30).addTo(earth);
        // marker4.bindPopup("<b>VDNH</b><br>Architectural Maket<br /><span> Arhitecture</span><a href='/VDNH'> Explore</a> ", {maxWidth: 150, closeButton: true});

        // var marker5 = WE.marker([55.771459, 37.597428],  'markers/artist_arch.png', 30, 30).addTo(earth);
        // marker5.bindPopup("<b>betrede.lab</b><br>Architecture<br /><span> Arhitecture</span><a href='/betrede.lab'> Explore</a> ", {maxWidth: 150, closeButton: true});

        // var marker6 = WE.marker([55.745755, 37.627210],  'markers/artist_design.png', 30, 30).addTo(earth);
        // marker6.bindPopup("<b>betrede.design</b><br>Design<br /><span>Design</span><a href='/betrede.design'> Explore</a> ", {maxWidth: 150, closeButton: true});

        // var marker7 = WE.marker([55.759137, 37.610811],  'markers/artist_design.png', 30, 30).addTo(earth);
        // marker7.bindPopup("<b>betrede.showbuisnes</b><br>Show<br /><span>Show</span><a href='/betrede.showbuisnes'> Explore</a> ", {maxWidth: 150, closeButton: true});

        //var marker8 = WE.marker([55.772421, 37.611006],  'markers/artist_design.png', 30, 30).addTo(earth);
       // marker8.bindPopup("<b>Stereotactic</b><br>event<br /><span>design</span><a href='/stereotactic'> Explore</a> ", {maxWidth: 150, closeButton: true});

        // var marker9 = WE.marker([55.767586, 37.680975],  'markers/artist_painter.png', 30, 30).addTo(earth);
        // marker9.bindPopup("<b>Natalie Rukavishnikova</b><br>Gallery<br /><span>Gallery</span><a href='/natalie.rukavishnikova'> Explore</a> ", {maxWidth: 150, closeButton: true});

        earth.panInsideBounds(bounds);
        // earth.panTo([55.779891, 37.579534]);
        
        // earth.zoomIn(10);
    }
 </script>
   </body>
   </html>